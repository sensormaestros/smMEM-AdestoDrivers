<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>Adesto Flash Demo: SPI</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="EMSTRS, LightBulb, 200x284.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Adesto Flash Demo
   &#160;<span id="projectnumber">V1.0</span>
   </div>
   <div id="projectbrief">Adesto Flash/Resistive Memory Evaluation and Drivers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group___s_p_i.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Modules</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">SPI<div class="ingroups"><a class="el" href="group___peripheral___functions.html">Peripheral_Functions</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga2d6192446b4fce35dd45846b660a69c7"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga2d6192446b4fce35dd45846b660a69c7"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>PASTE_</b>(A, B)&#160;&#160;&#160;A##B</td></tr>
<tr class="separator:ga2d6192446b4fce35dd45846b660a69c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0a1805ba9af748609d09d5c3ee877db1"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga0a1805ba9af748609d09d5c3ee877db1"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>PASTE</b>(A, B)&#160;&#160;&#160;PASTE_(A, B)</td></tr>
<tr class="separator:ga0a1805ba9af748609d09d5c3ee877db1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0f8c05ffb41408b9d6ef2f357aa6a3e7"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga0f8c05ffb41408b9d6ef2f357aa6a3e7"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>PASTE3_</b>(A, B, C)&#160;&#160;&#160;A##B##C</td></tr>
<tr class="separator:ga0f8c05ffb41408b9d6ef2f357aa6a3e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga687480e3dd63cd345e0b26f4c99aadef"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga687480e3dd63cd345e0b26f4c99aadef"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>PASTE3</b>(A, B, C)&#160;&#160;&#160;PASTE3_(A, B, C)</td></tr>
<tr class="separator:ga687480e3dd63cd345e0b26f4c99aadef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8112c985f7444e82198d7571ce0a9160"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___s_p_i.html#ga8112c985f7444e82198d7571ce0a9160">SPI_PORT</a>&#160;&#160;&#160;PASTE(USART, USART_NUM)</td></tr>
<tr class="separator:ga8112c985f7444e82198d7571ce0a9160"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaaae2fe48576d49ba3e4da753541c06e7"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaaae2fe48576d49ba3e4da753541c06e7"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SPI_TX_IRQn</b>&#160;&#160;&#160;PASTE3(USART, USART_NUM, _TX_IRQn)</td></tr>
<tr class="separator:gaaae2fe48576d49ba3e4da753541c06e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga485b2d79eda0fe4639d38192e9c3850a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga485b2d79eda0fe4639d38192e9c3850a"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SPI_RX_IRQn</b>&#160;&#160;&#160;PASTE3(USART, USART_NUM, _RX_IRQn)</td></tr>
<tr class="separator:ga485b2d79eda0fe4639d38192e9c3850a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaac4ffdbfa30aa9816d962336404a35e6"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaac4ffdbfa30aa9816d962336404a35e6"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SERIAL_TX_IRQHandler</b>&#160;&#160;&#160;PASTE3(USART, USART_NUM, _TX_IRQHandler</td></tr>
<tr class="separator:gaac4ffdbfa30aa9816d962336404a35e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga14dbbec36ad2ebdbb0d82ae168a5554d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga14dbbec36ad2ebdbb0d82ae168a5554d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SERIAL_RX_IRQHandler</b>&#160;&#160;&#160;PASTE3(USART, USART_NUM, _RX_IRQHandler</td></tr>
<tr class="separator:ga14dbbec36ad2ebdbb0d82ae168a5554d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadb08e74bdf986d1fa0dbc980dd8d3ff9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gadb08e74bdf986d1fa0dbc980dd8d3ff9"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SPI_cmuClock</b>&#160;&#160;&#160;PASTE(cmuClock_USART, USART_NUM)</td></tr>
<tr class="separator:gadb08e74bdf986d1fa0dbc980dd8d3ff9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad070555d9cd567a383a4d3eedcf6788f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gad070555d9cd567a383a4d3eedcf6788f"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CK_PORT</b>&#160;&#160;&#160;gpioPortD</td></tr>
<tr class="separator:gad070555d9cd567a383a4d3eedcf6788f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadf73e2e9759477ffd0472a4147e48eea"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gadf73e2e9759477ffd0472a4147e48eea"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CK_PIN</b>&#160;&#160;&#160;2</td></tr>
<tr class="separator:gadf73e2e9759477ffd0472a4147e48eea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab313428e4d073b4508a15ca9d593733e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gab313428e4d073b4508a15ca9d593733e"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CS_PORT</b>&#160;&#160;&#160;gpioPortD</td></tr>
<tr class="separator:gab313428e4d073b4508a15ca9d593733e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabfcf05153ddbd63d5aff5d018867cc19"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gabfcf05153ddbd63d5aff5d018867cc19"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CS_PIN</b>&#160;&#160;&#160;3</td></tr>
<tr class="separator:gabfcf05153ddbd63d5aff5d018867cc19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae16aaa5886d6359f49685dfbd2a5b8d5"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gae16aaa5886d6359f49685dfbd2a5b8d5"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>RX_PORT</b>&#160;&#160;&#160;gpioPortD</td></tr>
<tr class="separator:gae16aaa5886d6359f49685dfbd2a5b8d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa7089c01538b339ae745173c117f95b9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaa7089c01538b339ae745173c117f95b9"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>RX_PIN</b>&#160;&#160;&#160;1</td></tr>
<tr class="separator:gaa7089c01538b339ae745173c117f95b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3e46be55b4bfb3e39bf4ffcd7e8d564c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga3e46be55b4bfb3e39bf4ffcd7e8d564c"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>TX_PORT</b>&#160;&#160;&#160;gpioPortD</td></tr>
<tr class="separator:ga3e46be55b4bfb3e39bf4ffcd7e8d564c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3bb17f5daa2b1eaef58c8aa2d989e27e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga3bb17f5daa2b1eaef58c8aa2d989e27e"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>TX_PIN</b>&#160;&#160;&#160;0</td></tr>
<tr class="separator:ga3bb17f5daa2b1eaef58c8aa2d989e27e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga373a0d1e3e41942ccb84e41d0f082248"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga373a0d1e3e41942ccb84e41d0f082248"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>USART_NUM</b>&#160;&#160;&#160;1</td></tr>
<tr class="separator:ga373a0d1e3e41942ccb84e41d0f082248"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafe04f9fb18d73713192dee8c14d6ec01"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gafe04f9fb18d73713192dee8c14d6ec01"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>USART_LOC</b>&#160;&#160;&#160;1</td></tr>
<tr class="separator:gafe04f9fb18d73713192dee8c14d6ec01"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7bc84b8050c2cf44435c64c1593d5a59"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga7bc84b8050c2cf44435c64c1593d5a59"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>USE_SO_IRQ</b>&#160;&#160;&#160;1</td></tr>
<tr class="separator:ga7bc84b8050c2cf44435c64c1593d5a59"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ga4340deedf2cebc085a985281ff348a5e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga4340deedf2cebc085a985281ff348a5e"></a>
typedef void&#160;</td><td class="memItemRight" valign="bottom"><b>spi_completion_fn_t</b> (void *ref)</td></tr>
<tr class="separator:ga4340deedf2cebc085a985281ff348a5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gae5d386ffad5008abd9d60c6cfc6739c0"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___s_p_i.html#gae5d386ffad5008abd9d60c6cfc6739c0">spi_active</a> (void)</td></tr>
<tr class="memdesc:gae5d386ffad5008abd9d60c6cfc6739c0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called to determine if SPI bus is active.  <a href="#gae5d386ffad5008abd9d60c6cfc6739c0">More...</a><br /></td></tr>
<tr class="separator:gae5d386ffad5008abd9d60c6cfc6739c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa6a5099bafcea7a957c8a7aff925a5c2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___s_p_i.html#gaa6a5099bafcea7a957c8a7aff925a5c2">USART1_RX_IRQHandler</a> (void)</td></tr>
<tr class="memdesc:gaa6a5099bafcea7a957c8a7aff925a5c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">USART/SPI1 RX Interrupt Handler.  <a href="#gaa6a5099bafcea7a957c8a7aff925a5c2">More...</a><br /></td></tr>
<tr class="separator:gaa6a5099bafcea7a957c8a7aff925a5c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf7afa223a57cccc216b627b070ad9443"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___s_p_i.html#gaf7afa223a57cccc216b627b070ad9443">USART1_TX_IRQHandler</a> (void)</td></tr>
<tr class="memdesc:gaf7afa223a57cccc216b627b070ad9443"><td class="mdescLeft">&#160;</td><td class="mdescRight">USART/SPI1 RX Interrupt Handler.  <a href="#gaf7afa223a57cccc216b627b070ad9443">More...</a><br /></td></tr>
<tr class="separator:gaf7afa223a57cccc216b627b070ad9443"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9dd3eb81c6ecd8a3ce3f70d2315c0d07"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___s_p_i.html#ga9dd3eb81c6ecd8a3ce3f70d2315c0d07">spi_xfer</a> (size_t tx_len, const uint8_t *tx_data, size_t tx2_len, const uint8_t *tx2_data, bool half_duplex, size_t rx_len, uint8_t *rx_data, bool hold_cs_active, spi_completion_fn_t *completion, void *completion_ref)</td></tr>
<tr class="memdesc:ga9dd3eb81c6ecd8a3ce3f70d2315c0d07"><td class="mdescLeft">&#160;</td><td class="mdescRight">SPI transfer function.  <a href="#ga9dd3eb81c6ecd8a3ce3f70d2315c0d07">More...</a><br /></td></tr>
<tr class="separator:ga9dd3eb81c6ecd8a3ce3f70d2315c0d07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafdea2220aa9b94ccd2a404a3da58014b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___s_p_i.html#gafdea2220aa9b94ccd2a404a3da58014b">SO_IRQ</a> (void *ref)</td></tr>
<tr class="memdesc:gafdea2220aa9b94ccd2a404a3da58014b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Active SO Interrupt handler.  <a href="#gafdea2220aa9b94ccd2a404a3da58014b">More...</a><br /></td></tr>
<tr class="separator:gafdea2220aa9b94ccd2a404a3da58014b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7692b03652af590216211f3e2c261535"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___s_p_i.html#ga7692b03652af590216211f3e2c261535">spi_wait_so</a> (uint8_t level, spi_completion_fn_t *completion, void *completion_ref)</td></tr>
<tr class="memdesc:ga7692b03652af590216211f3e2c261535"><td class="mdescLeft">&#160;</td><td class="mdescRight">Active SO Interrupt handler.  <a href="#ga7692b03652af590216211f3e2c261535">More...</a><br /></td></tr>
<tr class="separator:ga7692b03652af590216211f3e2c261535"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae4fdb45bc59bf5e40fb1b81fa23dc83d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___s_p_i.html#gae4fdb45bc59bf5e40fb1b81fa23dc83d">spi_init</a> (int bit_rate)</td></tr>
<tr class="memdesc:gae4fdb45bc59bf5e40fb1b81fa23dc83d"><td class="mdescLeft">&#160;</td><td class="mdescRight">SPI/USART Initialization.  <a href="#gae4fdb45bc59bf5e40fb1b81fa23dc83d">More...</a><br /></td></tr>
<tr class="separator:gae4fdb45bc59bf5e40fb1b81fa23dc83d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ga3e22f49776c940dc9f898e5ed9f2b566"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga3e22f49776c940dc9f898e5ed9f2b566"></a>
static bool&#160;</td><td class="memItemRight" valign="bottom"><b>spi_busy</b></td></tr>
<tr class="separator:ga3e22f49776c940dc9f898e5ed9f2b566"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaae4e9bd51de8892d5a609ade9c121635"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaae4e9bd51de8892d5a609ade9c121635"></a>
static spi_completion_fn_t *&#160;</td><td class="memItemRight" valign="bottom"><b>spi_completion</b></td></tr>
<tr class="separator:gaae4e9bd51de8892d5a609ade9c121635"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga785102a0d9cb4164e4a99a7c68270d2b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga785102a0d9cb4164e4a99a7c68270d2b"></a>
static void *&#160;</td><td class="memItemRight" valign="bottom"><b>spi_completion_ref</b></td></tr>
<tr class="separator:ga785102a0d9cb4164e4a99a7c68270d2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga35b4fa5159f59a3068e26046aa9fee7b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga35b4fa5159f59a3068e26046aa9fee7b"></a>
static size_t&#160;</td><td class="memItemRight" valign="bottom"><b>spi_tx_len</b></td></tr>
<tr class="separator:ga35b4fa5159f59a3068e26046aa9fee7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabf125405b5cdfec2579d517b40aee949"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gabf125405b5cdfec2579d517b40aee949"></a>
static const uint8_t *&#160;</td><td class="memItemRight" valign="bottom"><b>spi_tx_data</b></td></tr>
<tr class="separator:gabf125405b5cdfec2579d517b40aee949"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaddcbbe04d2a742e1bc6dde130b8c0cdb"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaddcbbe04d2a742e1bc6dde130b8c0cdb"></a>
static size_t&#160;</td><td class="memItemRight" valign="bottom"><b>spi_tx2_len</b></td></tr>
<tr class="separator:gaddcbbe04d2a742e1bc6dde130b8c0cdb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga92a5b84703501ef14362518aa09644f4"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga92a5b84703501ef14362518aa09644f4"></a>
static const uint8_t *&#160;</td><td class="memItemRight" valign="bottom"><b>spi_tx2_data</b></td></tr>
<tr class="separator:ga92a5b84703501ef14362518aa09644f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2f54dbb7812d5613ff070d661372b417"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga2f54dbb7812d5613ff070d661372b417"></a>
static size_t&#160;</td><td class="memItemRight" valign="bottom"><b>spi_tx_post_padding_len</b></td></tr>
<tr class="separator:ga2f54dbb7812d5613ff070d661372b417"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6425c2493a4cca118a09e275011d65dd"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga6425c2493a4cca118a09e275011d65dd"></a>
static size_t&#160;</td><td class="memItemRight" valign="bottom"><b>spi_rx_pre_padding_len</b></td></tr>
<tr class="separator:ga6425c2493a4cca118a09e275011d65dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaec2be1b42ef700c7b51e0095309c7e90"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaec2be1b42ef700c7b51e0095309c7e90"></a>
static size_t&#160;</td><td class="memItemRight" valign="bottom"><b>spi_rx_len</b></td></tr>
<tr class="separator:gaec2be1b42ef700c7b51e0095309c7e90"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga030984580f7c0bbc9b34bd15be36ab63"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga030984580f7c0bbc9b34bd15be36ab63"></a>
static uint8_t *&#160;</td><td class="memItemRight" valign="bottom"><b>spi_rx_data</b></td></tr>
<tr class="separator:ga030984580f7c0bbc9b34bd15be36ab63"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf32c3f4ec366f001c27ef398be274f47"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaf32c3f4ec366f001c27ef398be274f47"></a>
static size_t&#160;</td><td class="memItemRight" valign="bottom"><b>spi_rx_post_padding_len</b></td></tr>
<tr class="separator:gaf32c3f4ec366f001c27ef398be274f47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0aedf2b02ae2db7e02fc3a9e0708c927"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga0aedf2b02ae2db7e02fc3a9e0708c927"></a>
static bool&#160;</td><td class="memItemRight" valign="bottom"><b>spi_hold_cs_active</b></td></tr>
<tr class="separator:ga0aedf2b02ae2db7e02fc3a9e0708c927"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga118da2efb70a2a8199a8a8642903c98b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga118da2efb70a2a8199a8a8642903c98b"></a>
static bool&#160;</td><td class="memItemRight" valign="bottom"><b>so_busy</b></td></tr>
<tr class="separator:ga118da2efb70a2a8199a8a8642903c98b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad996e17bd1b73b40a83e03ecfa315a16"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gad996e17bd1b73b40a83e03ecfa315a16"></a>
static spi_completion_fn_t *&#160;</td><td class="memItemRight" valign="bottom"><b>so_completion</b></td></tr>
<tr class="separator:gad996e17bd1b73b40a83e03ecfa315a16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga62ea44dee2a81f2180ee79694b93b30d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga62ea44dee2a81f2180ee79694b93b30d"></a>
static void *&#160;</td><td class="memItemRight" valign="bottom"><b>so_completion_ref</b></td></tr>
<tr class="separator:ga62ea44dee2a81f2180ee79694b93b30d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga35d9914745e2ff92463a16b518510704"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga35d9914745e2ff92463a16b518510704"></a>
volatile uint32_t&#160;</td><td class="memItemRight" valign="bottom"><b>so_irq_count</b></td></tr>
<tr class="separator:ga35d9914745e2ff92463a16b518510704"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga15deb3096acd2dc719e782f5493b8377"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga15deb3096acd2dc719e782f5493b8377"></a>
volatile uint32_t&#160;</td><td class="memItemRight" valign="bottom"><b>so_spurious_irq_count</b></td></tr>
<tr class="separator:ga15deb3096acd2dc719e782f5493b8377"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7455cde98d1a48495cfb9dcd97730347"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga7455cde98d1a48495cfb9dcd97730347"></a>
volatile uint32_t&#160;</td><td class="memItemRight" valign="bottom"><b>so_irq_fake_count</b></td></tr>
<tr class="separator:ga7455cde98d1a48495cfb9dcd97730347"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab1607beee9b5a5dbc1057d76dd93b10c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gab1607beee9b5a5dbc1057d76dd93b10c"></a>
volatile unsigned&#160;</td><td class="memItemRight" valign="bottom"><b>p1</b></td></tr>
<tr class="separator:gab1607beee9b5a5dbc1057d76dd93b10c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga38c6e9701e1c55672161372811a7fe4e"><td class="memItemLeft" align="right" valign="top">USART_InitSync_TypeDef&#160;</td><td class="memItemRight" valign="bottom"><b>spiInit</b></td></tr>
<tr class="separator:ga38c6e9701e1c55672161372811a7fe4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadb8531ea9fa8cf3157bff482d06a2910"><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="structgpio__init__t.html">gpio_init_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>spi_pins</b> []</td></tr>
<tr class="separator:gadb8531ea9fa8cf3157bff482d06a2910"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ga8112c985f7444e82198d7571ce0a9160"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SPI_PORT&#160;&#160;&#160;PASTE(USART, USART_NUM)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="spi_8c.html">spi.c</a>&gt;</code></p>
<pre class="fragment">*  The defines below are intended to allow any Leopard Gecko or Giant Gecko
*  USART number and location to be used, but only USART1 location 1 has been
*  tested.
*  </pre> 
<p>Definition at line <a class="el" href="spi_8c_source.html#l00065">65</a> of file <a class="el" href="spi_8c_source.html">spi.c</a>.</p>

<p>Referenced by <a class="el" href="spi_8c_source.html#l00526">spi_init()</a>, <a class="el" href="spi_8c_source.html#l00327">spi_xfer()</a>, <a class="el" href="spi_8c_source.html#l00227">USART1_RX_IRQHandler()</a>, and <a class="el" href="spi_8c_source.html#l00272">USART1_TX_IRQHandler()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gae5d386ffad5008abd9d60c6cfc6739c0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool spi_active </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="spi_8c.html">spi.c</a>&gt;</code></p>

<p>Called to determine if SPI bus is active. </p>
<dl class="section note"><dt>Note</dt><dd>Typically used to determine if Low Power/EM Modes can be entered. </dd></dl>
<dl class="section return"><dt>Returns</dt><dd>spi_busy TRUE/FALSE </dd></dl>

<p>Definition at line <a class="el" href="spi_8c_source.html#l00214">214</a> of file <a class="el" href="spi_8c_source.html">spi.c</a>.</p>

<p>Referenced by <a class="el" href="low__power_8c_source.html#l00082">enter_low_power_state()</a>.</p>
<div class="fragment"><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;{</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">return</span> spi_busy;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaa6a5099bafcea7a957c8a7aff925a5c2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USART1_RX_IRQHandler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="spi_8c.html">spi.c</a>&gt;</code></p>

<p>USART/SPI1 RX Interrupt Handler. </p>
<dl class="section note"><dt>Note</dt><dd>Copies Received data in spi_rx_data buffer. </dd></dl>

<p>Definition at line <a class="el" href="spi_8c_source.html#l00227">227</a> of file <a class="el" href="spi_8c_source.html">spi.c</a>.</p>

<p>References <a class="el" href="spi_8c_source.html#l00065">SPI_PORT</a>.</p>
<div class="fragment"><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;{</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    uint8_t dummy;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group___s_p_i.html#ga8112c985f7444e82198d7571ce0a9160">SPI_PORT</a>-&gt;IF &amp; USART_IF_RXDATAV)</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    {</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="keywordflow">if</span> (spi_rx_pre_padding_len)</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        {</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            dummy = <a class="code" href="group___s_p_i.html#ga8112c985f7444e82198d7571ce0a9160">SPI_PORT</a>-&gt;RXDATA;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            (void) dummy;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            spi_rx_pre_padding_len--;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (spi_rx_len)</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            *spi_rx_data++ = <a class="code" href="group___s_p_i.html#ga8112c985f7444e82198d7571ce0a9160">SPI_PORT</a>-&gt;RXDATA;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            spi_rx_len--;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (spi_rx_post_padding_len)</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        {</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            dummy = <a class="code" href="group___s_p_i.html#ga8112c985f7444e82198d7571ce0a9160">SPI_PORT</a>-&gt;RXDATA;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            (void) dummy;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            spi_rx_post_padding_len--;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        }</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordflow">if</span> ((spi_rx_pre_padding_len == 0) &amp;&amp; (spi_rx_len == 0) &amp;&amp; (spi_rx_post_padding_len == 0))</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            <span class="comment">// copy completion fn ptr and ref arg, to avoid race condition</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            <span class="comment">// if completion fn starts another SPI xfer</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            spi_completion_fn_t *completion = spi_completion;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            <span class="keywordtype">void</span> *completion_ref = spi_completion_ref;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            <a class="code" href="group___s_p_i.html#ga8112c985f7444e82198d7571ce0a9160">SPI_PORT</a>-&gt;IEN &amp;= ~ USART_IEN_RXDATAV;  <span class="comment">// disable rx interrupt</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            <span class="keywordflow">if</span> (! spi_hold_cs_active)</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                GPIO_PinOutSet(CS_PORT, CS_PIN);  <span class="comment">// deassert CS</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            spi_busy = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            <span class="keywordflow">if</span> (completion)</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                completion(completion_ref);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    }</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;}</div>
<div class="ttc" id="group___s_p_i_html_ga8112c985f7444e82198d7571ce0a9160"><div class="ttname"><a href="group___s_p_i.html#ga8112c985f7444e82198d7571ce0a9160">SPI_PORT</a></div><div class="ttdeci">#define SPI_PORT</div><div class="ttdef"><b>Definition:</b> <a href="spi_8c_source.html#l00065">spi.c:65</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaf7afa223a57cccc216b627b070ad9443"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USART1_TX_IRQHandler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="spi_8c.html">spi.c</a>&gt;</code></p>

<p>USART/SPI1 RX Interrupt Handler. </p>
<dl class="section note"><dt>Note</dt><dd>Copies TX data into spi_tx_data buffer. </dd></dl>

<p>Definition at line <a class="el" href="spi_8c_source.html#l00272">272</a> of file <a class="el" href="spi_8c_source.html">spi.c</a>.</p>

<p>References <a class="el" href="spi_8c_source.html#l00065">SPI_PORT</a>.</p>
<div class="fragment"><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;{</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group___s_p_i.html#ga8112c985f7444e82198d7571ce0a9160">SPI_PORT</a>-&gt;IF &amp; USART_IF_TXBL)</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    {</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <span class="keywordflow">if</span> (spi_tx_len)</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            <a class="code" href="group___s_p_i.html#ga8112c985f7444e82198d7571ce0a9160">SPI_PORT</a>-&gt;TXDATA = *spi_tx_data++;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            spi_tx_len--;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (spi_tx2_len)</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        {</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            <a class="code" href="group___s_p_i.html#ga8112c985f7444e82198d7571ce0a9160">SPI_PORT</a>-&gt;TXDATA = *spi_tx2_data++;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            spi_tx2_len--;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (spi_tx_post_padding_len)</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        {</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            <a class="code" href="group___s_p_i.html#ga8112c985f7444e82198d7571ce0a9160">SPI_PORT</a>-&gt;TXDATA = 0x00;  <span class="comment">// still more to rx, so tx dummy byte</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            spi_tx_post_padding_len--;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordflow">if</span>((spi_tx_len == 0) &amp;&amp; (spi_tx2_len == 0) &amp;&amp; (spi_tx_post_padding_len == 0))</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            <a class="code" href="group___s_p_i.html#ga8112c985f7444e82198d7571ce0a9160">SPI_PORT</a>-&gt;IEN &amp;= ~ USART_IEN_TXBL;  <span class="comment">// disable tx interrupt</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    }</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;}</div>
<div class="ttc" id="group___s_p_i_html_ga8112c985f7444e82198d7571ce0a9160"><div class="ttname"><a href="group___s_p_i.html#ga8112c985f7444e82198d7571ce0a9160">SPI_PORT</a></div><div class="ttdeci">#define SPI_PORT</div><div class="ttdef"><b>Definition:</b> <a href="spi_8c_source.html#l00065">spi.c:65</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga9dd3eb81c6ecd8a3ce3f70d2315c0d07"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void spi_xfer </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>tx_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>tx_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>tx2_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>tx2_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>half_duplex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>rx_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>rx_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>hold_cs_active</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">spi_completion_fn_t *&#160;</td>
          <td class="paramname"><em>completion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>completion_ref</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="spi_8c.html">spi.c</a>&gt;</code></p>

<p>SPI transfer function. </p>
<p>Performs one SPI transaction. Fundamentally SPI does a write and read of the same length (byte count) at the same time. Often only a few bytes are to be written, and the data returned while those bytes are written is to be discarded. This can be done using the "half_duplex" flag. The data to be written may optionally be split into two separate buffers in order to handle discontiguous data. Set tx_len or tx_len2 to 0 if the corresponding buffer is not used. Will block if NULL passed for completion function; otherwise will call completion function passing ref argument. Note that completion function may be called either before or after the function returns.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">tx_len</td><td>Number of bytes to transfer from tx buffer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">*tx_data</td><td>Pointer to data to be transferred/TX'd </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tx2_len</td><td>Number of bytes to transfer from tx2 buffer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">*tx2_data</td><td>Pointer to data to be transferred from tx2 buffer. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">hold_cs_active</td><td>TRUE/FALSE, Determines whether to hold CS active </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">*completion</td><td>Completion state machine callback function </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">*completion_ref</td><td>Argument to be passed to completion callback </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="spi_8c_source.html#l00327">327</a> of file <a class="el" href="spi_8c_source.html">spi.c</a>.</p>

<p>References <a class="el" href="spi_8c_source.html#l00065">SPI_PORT</a>.</p>

<p>Referenced by <a class="el" href="spiflash_8c_source.html#l00419">spiflash_command_with_address()</a>, <a class="el" href="spiflash_8c_source.html#l00367">spiflash_multiple_byte_command()</a>, and <a class="el" href="spiflash_8c_source.html#l00319">spiflash_single_byte_command()</a>.</p>
<div class="fragment"><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;{</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    spi_rx_len = rx_len;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    spi_rx_data = rx_data;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    spi_tx_len = tx_len;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    spi_tx_data = tx_data;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    spi_tx2_len = tx2_len;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    spi_tx2_data = tx2_data;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    spi_tx_post_padding_len = 0;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    spi_rx_pre_padding_len = 0;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    spi_rx_post_padding_len = 0;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    spi_hold_cs_active = hold_cs_active;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">if</span> (half_duplex)</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        spi_rx_pre_padding_len = tx_len + tx2_len;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        spi_tx_post_padding_len = spi_rx_len;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    }</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((tx_len + tx2_len) &lt; rx_len)</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        spi_tx_post_padding_len = rx_len - (tx_len + tx2_len);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        spi_rx_post_padding_len = (tx_len + tx2_len) - rx_len;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="comment">//printf(&quot;tx: %d, tx2: %d, tx_post: %d\r\n&quot;, tx_len, tx2_len, spi_tx_post_padding_len);</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="comment">//printf(&quot;rx_pre: %d, rx: %d, rx_post: %d\r\n&quot;, spi_rx_pre_padding_len, rx_len, spi_rx_post_padding_len);</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    spi_completion = completion;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    spi_completion_ref = completion_ref;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    spi_busy = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    GPIO_PinOutClear(CS_PORT, CS_PIN);  <span class="comment">// assert CS</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="comment">// enable interrupts to start transfer</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <a class="code" href="group___s_p_i.html#ga8112c985f7444e82198d7571ce0a9160">SPI_PORT</a>-&gt;IEN |= (USART_IEN_TXBL | USART_IEN_RXDATAV);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordflow">if</span> (! completion)</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="keywordflow">while</span> (spi_busy)</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            EMU_EnterEM1();</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;}</div>
<div class="ttc" id="group___s_p_i_html_ga8112c985f7444e82198d7571ce0a9160"><div class="ttname"><a href="group___s_p_i.html#ga8112c985f7444e82198d7571ce0a9160">SPI_PORT</a></div><div class="ttdeci">#define SPI_PORT</div><div class="ttdef"><b>Definition:</b> <a href="spi_8c_source.html#l00065">spi.c:65</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gafdea2220aa9b94ccd2a404a3da58014b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SO_IRQ </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ref</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="spi_8c.html">spi.c</a>&gt;</code></p>

<p>Active SO Interrupt handler. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">*ref</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="spi_8c_source.html#l00397">397</a> of file <a class="el" href="spi_8c_source.html">spi.c</a>.</p>

<p>Referenced by <a class="el" href="spi_8c_source.html#l00526">spi_init()</a>, and <a class="el" href="spi_8c_source.html#l00459">spi_wait_so()</a>.</p>
<div class="fragment"><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;{</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    (void) ref;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordtype">int</span> p = GPIO_PinInGet(RX_PORT, RX_PIN);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">if</span> (p != 0)</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    {</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="comment">// should never happen - we should only get the interrupt when the pin goes low</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        GPIO-&gt;IFC = 1 &lt;&lt; RX_PIN;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        so_spurious_irq_count++;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    }</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="comment">// disable IRQ</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    GPIO_IntConfig(RX_PORT, RX_PIN,</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                   <span class="keyword">false</span>,   <span class="comment">// risingEdge</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                   <span class="keyword">false</span>,   <span class="comment">// fallingEdge</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                   <span class="keyword">false</span>);  <span class="comment">// enable</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    so_irq_count++;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keywordflow">if</span> (! so_busy)</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <span class="comment">// should never happen</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <span class="keywordflow">while</span> (1)</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            ;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    }</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    GPIO_PinOutSet(CS_PORT, CS_PIN);  <span class="comment">// deassert CS</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="comment">// copy completion fn ptr and ref arg, to avoid race condition</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="comment">// if completion fn starts another SPI xfer</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    spi_completion_fn_t *completion = so_completion;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordtype">void</span> *completion_ref = so_completion_ref;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    so_busy = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordflow">if</span> (completion)</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        completion(completion_ref);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga7692b03652af590216211f3e2c261535"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void spi_wait_so </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">spi_completion_fn_t *&#160;</td>
          <td class="paramname"><em>completion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>completion_ref</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="spi_8c.html">spi.c</a>&gt;</code></p>

<p>Active SO Interrupt handler. </p>
<dl class="section note"><dt>Note</dt><dd>Note: may be called synchronously (completion == NULL), in which case this function does not return until the SO interrupt occurs, or asynchronously (completion != NULL), in which case this function merely sets up the interrupt, returns to the caller, and the caller should do whatever is desired until the SO interrupt occurs, at which time the completion function is called. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">level</td><td>Determines Edge Level Interrupt: Rising/Falling, spiflash_info-&gt;so_done_level is the variable that is passed into the function and is initialized in the Device table found in <a class="el" href="spiflash_8c_source.html">spiflash.c</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">*completion</td><td>Completion State machine callback function </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">*completion_ref</td><td>Argument to be passed to completion callback </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="spi_8c_source.html#l00459">459</a> of file <a class="el" href="spi_8c_source.html">spi.c</a>.</p>

<p>References <a class="el" href="low__power_8c_source.html#l00082">enter_low_power_state()</a>, and <a class="el" href="spi_8c_source.html#l00397">SO_IRQ()</a>.</p>

<p>Referenced by <a class="el" href="spiflash_8c_source.html#l00657">spiflash_erase_completion4()</a>, and <a class="el" href="spiflash_8c_source.html#l00915">spiflash_write_completion4()</a>.</p>
<div class="fragment"><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;{</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    so_completion = completion;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    so_completion_ref = completion_ref;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    so_busy = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    INT_Disable();</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="comment">// enable IRQ</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="comment">// The EFM32 has edge-triggered interrupts, so we&#39;ll never get an</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="comment">// interrupt if the port pin was already at the desired level.  To</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="comment">// avoid deadlock, we check the pin state here, and if it&#39;s already</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="comment">// at the desired level, simulate an edge interrupt.</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    p1 = GPIO_PinInGet(RX_PORT, RX_PIN);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordflow">if</span> (p1 == level)</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    {</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        so_irq_fake_count++;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <a class="code" href="group___s_p_i.html#gafdea2220aa9b94ccd2a404a3da58014b">SO_IRQ</a>(NULL);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    }</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    {</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="comment">// Note that GPIO_IntConfig will clear any pending IRQ for the pin</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        GPIO_IntConfig(RX_PORT, RX_PIN,</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                       level,  <span class="comment">// risingEdge</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                       !level, <span class="comment">// fallingEdge</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                       <span class="keyword">true</span>);  <span class="comment">// enable</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    }</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    INT_Enable();</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="comment">// if called synchronously, actually wait here</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordflow">if</span> (!completion)</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <span class="keywordflow">while</span> (so_busy)</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;            <a class="code" href="group___low___power.html#gab58ec15d0bda335aa71a0e60a37d3f23">enter_low_power_state</a>();</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;}</div>
<div class="ttc" id="group___s_p_i_html_gafdea2220aa9b94ccd2a404a3da58014b"><div class="ttname"><a href="group___s_p_i.html#gafdea2220aa9b94ccd2a404a3da58014b">SO_IRQ</a></div><div class="ttdeci">void SO_IRQ(void *ref)</div><div class="ttdoc">Active SO Interrupt handler. </div><div class="ttdef"><b>Definition:</b> <a href="spi_8c_source.html#l00397">spi.c:397</a></div></div>
<div class="ttc" id="group___low___power_html_gab58ec15d0bda335aa71a0e60a37d3f23"><div class="ttname"><a href="group___low___power.html#gab58ec15d0bda335aa71a0e60a37d3f23">enter_low_power_state</a></div><div class="ttdeci">void enter_low_power_state(void)</div><div class="ttdoc">Decides whether to put EFM into EM0, EM1, or EM2 based on Activity. </div><div class="ttdef"><b>Definition:</b> <a href="low__power_8c_source.html#l00082">low_power.c:82</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gae4fdb45bc59bf5e40fb1b81fa23dc83d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void spi_init </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>bit_rate</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="spi_8c.html">spi.c</a>&gt;</code></p>

<p>SPI/USART Initialization. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">bit_rate</td><td>Bit rate for SPI Bus in MHz: Either 2000000 or 12000000 </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="spi_8c_source.html#l00526">526</a> of file <a class="el" href="spi_8c_source.html">spi.c</a>.</p>

<p>References <a class="el" href="gpio_8c_source.html#l00065">gpio_init()</a>, <a class="el" href="gpio_8c_source.html#l00152">gpio_irq_handler_install()</a>, <a class="el" href="spi_8c_source.html#l00397">SO_IRQ()</a>, and <a class="el" href="spi_8c_source.html#l00065">SPI_PORT</a>.</p>

<p>Referenced by <a class="el" href="spiflash_8c_source.html#l01480">spiflash_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;{</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    CMU_ClockEnable(cmuClock_GPIO, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    CMU_ClockEnable(SPI_cmuClock, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <a class="code" href="group___g_p_i_o.html#ga17e256c6a6b32d8f2a491beb026cb333">gpio_init</a>(spi_pins, <span class="keyword">sizeof</span>(spi_pins)/<span class="keyword">sizeof</span>(<a class="code" href="structgpio__init__t.html">gpio_init_t</a>));</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    USART_Reset(<a class="code" href="group___s_p_i.html#ga8112c985f7444e82198d7571ce0a9160">SPI_PORT</a>);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    USART_InitSync(<a class="code" href="group___s_p_i.html#ga8112c985f7444e82198d7571ce0a9160">SPI_PORT</a>, &amp;spiInit);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <a class="code" href="group___s_p_i.html#ga8112c985f7444e82198d7571ce0a9160">SPI_PORT</a>-&gt;CTRL |= USART_CTRL_TXBIL_HALFFULL;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <a class="code" href="group___s_p_i.html#ga8112c985f7444e82198d7571ce0a9160">SPI_PORT</a>-&gt;ROUTE = USART_ROUTE_TXPEN | USART_ROUTE_RXPEN | USART_ROUTE_CLKPEN | (USART_LOC &lt;&lt; _USART_ROUTE_LOCATION_SHIFT);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keywordflow">if</span> (bit_rate)</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        USART_BaudrateSyncSet(<a class="code" href="group___s_p_i.html#ga8112c985f7444e82198d7571ce0a9160">SPI_PORT</a>, 0, bit_rate);</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    USART_IntClear(<a class="code" href="group___s_p_i.html#ga8112c985f7444e82198d7571ce0a9160">SPI_PORT</a>, USART_IF_RXDATAV | USART_IF_TXBL);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    NVIC_ClearPendingIRQ(SPI_TX_IRQn);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    NVIC_EnableIRQ(SPI_TX_IRQn);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    NVIC_ClearPendingIRQ(SPI_RX_IRQn);</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    NVIC_EnableIRQ(SPI_RX_IRQn);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    so_busy = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    so_irq_count = 0;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    so_spurious_irq_count = 0;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    so_irq_fake_count = 0;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="comment">// register (but don&#39;t enable) rx pin GPIO interrupt</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <a class="code" href="group___g_p_i_o.html#gac3bf33f7dd2e24f44cab453c014ac4b3">gpio_irq_handler_install</a>(RX_PORT, RX_PIN, <a class="code" href="group___s_p_i.html#gafdea2220aa9b94ccd2a404a3da58014b">SO_IRQ</a>, NULL);</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    }</div>
<div class="ttc" id="group___s_p_i_html_gafdea2220aa9b94ccd2a404a3da58014b"><div class="ttname"><a href="group___s_p_i.html#gafdea2220aa9b94ccd2a404a3da58014b">SO_IRQ</a></div><div class="ttdeci">void SO_IRQ(void *ref)</div><div class="ttdoc">Active SO Interrupt handler. </div><div class="ttdef"><b>Definition:</b> <a href="spi_8c_source.html#l00397">spi.c:397</a></div></div>
<div class="ttc" id="group___g_p_i_o_html_ga17e256c6a6b32d8f2a491beb026cb333"><div class="ttname"><a href="group___g_p_i_o.html#ga17e256c6a6b32d8f2a491beb026cb333">gpio_init</a></div><div class="ttdeci">void gpio_init(const gpio_init_t *table, unsigned int count)</div><div class="ttdoc">GPIO Initialization. </div><div class="ttdef"><b>Definition:</b> <a href="gpio_8c_source.html#l00065">gpio.c:65</a></div></div>
<div class="ttc" id="structgpio__init__t_html"><div class="ttname"><a href="structgpio__init__t.html">gpio_init_t</a></div><div class="ttdef"><b>Definition:</b> <a href="gpio_8h_source.html#l00050">gpio.h:50</a></div></div>
<div class="ttc" id="group___s_p_i_html_ga8112c985f7444e82198d7571ce0a9160"><div class="ttname"><a href="group___s_p_i.html#ga8112c985f7444e82198d7571ce0a9160">SPI_PORT</a></div><div class="ttdeci">#define SPI_PORT</div><div class="ttdef"><b>Definition:</b> <a href="spi_8c_source.html#l00065">spi.c:65</a></div></div>
<div class="ttc" id="group___g_p_i_o_html_gac3bf33f7dd2e24f44cab453c014ac4b3"><div class="ttname"><a href="group___g_p_i_o.html#gac3bf33f7dd2e24f44cab453c014ac4b3">gpio_irq_handler_install</a></div><div class="ttdeci">void gpio_irq_handler_install(GPIO_Port_TypeDef port, unsigned int pin, gpio_callback_t *callback, void *ref)</div><div class="ttdoc">GPIO Interrupt Callback Configuration. </div><div class="ttdef"><b>Definition:</b> <a href="gpio_8c_source.html#l00152">gpio.c:152</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="ga38c6e9701e1c55672161372811a7fe4e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">USART_InitSync_TypeDef spiInit</td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="spi_8c.html">spi.c</a>&gt;</code></p>
<b>Initial value:</b><div class="fragment"><div class="line">=</div>
<div class="line">{</div>
<div class="line">  .enable       = usartEnableRx | usartEnableTx,</div>
<div class="line">  .refFreq      = 0,</div>
<div class="line">  .baudrate     = 1000000,</div>
<div class="line">  .databits     = usartDatabits8,</div>
<div class="line">  .master       = <span class="keyword">true</span>,</div>
<div class="line">  .msbf         = <span class="keyword">true</span>,</div>
<div class="line">  .clockMode    = usartClockMode0,</div>
<div class="line">  .prsRxEnable  = <span class="keyword">false</span>,          </div>
<div class="line">  .prsRxCh      = usartPrsRxCh0,  </div>
<div class="line">  .autoTx       = <span class="keyword">false</span>,</div>
<div class="line">}</div>
</div><!-- fragment -->
<p>Definition at line <a class="el" href="spi_8c_source.html#l00496">496</a> of file <a class="el" href="spi_8c_source.html">spi.c</a>.</p>

</div>
</div>
<a class="anchor" id="gadb8531ea9fa8cf3157bff482d06a2910"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="structgpio__init__t.html">gpio_init_t</a> spi_pins[]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="spi_8c.html">spi.c</a>&gt;</code></p>
<b>Initial value:</b><div class="fragment"><div class="line">=</div>
<div class="line">{</div>
<div class="line">  {  gpioPortD ,  2 , gpioModePushPull,  0 },</div>
<div class="line">  {  gpioPortD ,  3 , gpioModePushPull,  1 },</div>
<div class="line">  {  gpioPortD ,  1 , gpioModeInputPull, 1 },</div>
<div class="line">  {  gpioPortD ,  0 , gpioModePushPull,  1 },</div>
<div class="line">}</div>
</div><!-- fragment -->
<p>Definition at line <a class="el" href="spi_8c_source.html#l00510">510</a> of file <a class="el" href="spi_8c_source.html">spi.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri May 20 2016 18:34:58 for Adesto Flash Demo by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8 </li>
  </ul>
</div>
</body>
</html>
